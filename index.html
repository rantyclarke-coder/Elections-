<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>US XXXX ELECTIONS</title>
  <script src="election1.js"></script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Mobile-first fonts (falls back to system fonts) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #000;
      --muted: #bfbfbf;
      --divider: #fff;
      --blue: #1e3fd9;
      --red: #dc143c;
      --grey: #cfcfcf;
      --pill: #4a4a4a;
      --max-width: 420px; /* target mobile portrait */
    }

    /* Safe area + base */
    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      color:#fff;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .page {
      box-sizing: border-box;
      padding: calc(16px + env(safe-area-inset-top)) 14px calc(18px + env(safe-area-inset-bottom)) 14px;
      max-width:var(--max-width);
      margin: 0 auto;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    /* Header */
.title {
  font-family: "League Spartan", system-ui, sans-serif;
  font-weight: 800;
  text-align: center;
  letter-spacing: 2px;
  font-size: 30px;
  margin: 8px 0 8px;
}
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@600;700;800&display=swap" rel="stylesheet">

    .top-divider {
  width: 72px;            /* REQUIRED — otherwise invisible */
  height: 3px;
  background: #ffffff;
  margin: 14px auto 10px;
  opacity: 1;
  border-radius: 2px;
    }

    .subtitle {
      text-align:center;
      color:var(--muted);
      font-size:12px;
      letter-spacing:3px;
      margin-bottom:12px;
    }

    /* Top row - candidate, bar, candidate */
    .top-row {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      width:100%;
      box-sizing:border-box;
    }

    .candidate {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
      width:88px; /* tight to fit on mobile with center bar */
      flex-shrink:0;
    }

    .photo {
      width:82px;
      height:96px;
      border-radius:50%;
      overflow:hidden;
      border:2px solid rgba(255,255,255,0.55);
      background:#222;
      box-shadow:0 6px 14px rgba(0,0,0,0.6);
    }
    .photo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .name {
      font-family: "Playfair Display", Georgia, serif;
      font-weight:900;
      font-size:22px;
      letter-spacing:2px;
      text-transform:uppercase;
      line-height:1;
      text-align:center;
    }

    .ev {
  font-family: "Inter", system-ui, sans-serif;
  font-size:40px;
  font-weight:900;
  line-height:1;
  letter-spacing:-1px;
    }

    /* Center bar area */
    .center {
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      padding:0 6px;
      box-sizing:border-box;
      min-width:120px;
    }

    .bar-wrap {
      width:100%;
      max-width:220px;
      position:relative;
      box-sizing:border-box;
    }

    .bar {
  display:flex;
  width:100%;
  height:28px;
  border-radius:14px;
  overflow:hidden;
  background:#222;
  border:2px solid rgba(255,255,255,0.05); /* thinner */
  box-shadow: inset 0 -3px 6px rgba(0,0,0,0.6);
    }

    .seg {
      height:100%;
      transition: width 500ms ease;
    }
    .seg.left { background: var(--blue); }
    .seg.unc { background: var(--grey); }
    .seg.right { background: var(--red); }

    /* 270 marker */
    .marker {
  position:absolute;
  top:-6px;
  left:50%;
  transform:translateX(-50%);
  width:1px;
  height:38px; /* slightly taller than bar */
  background:#fff;
  border-radius:2px;
    }
    .marker-label {
  position:absolute;
  top:-24px;   /* ABOVE the bar */
  left:50%;
  transform:translateX(-50%);
  font-size:10px;
  color:var(--muted);
  font-weight:700;
  white-space:nowrap;
    }
    .map object {
  width: 100%;
  height: 100%;
  max-width: 100%;
  max-height: 100%;
    }
    .map-inner {
  width: 100%;
  height: 100%;
  overflow: hidden;
    }
    .map-inner object {
  width: 100%;
  height: 100%;
  transform: scale(1.12) translateX(-4%);
  transform-origin: center;
    }

    .stats {
  width:100%;
  max-width:260px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
}

#left-stats {
  text-align:left;
}

#right-stats {
  text-align:right;
  white-space:pre-line;
}
    #left-stats,
#right-stats {
  font-size: 11px;      /* smaller, broadcast-style */
  line-height: 1.25;
  font-weight: 600;
}

    /* Map placeholder */
    .map {
      margin-top:18px;
      width:100%;
      height:44vh;
      background:#111;
      border:1px solid #333;
      border-radius:6px;
      box-shadow:0 8px 30px rgba(0,0,0,0.6);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#6f6f6f;
      font-size:13px;
    }
  

    /* Bottom pills */
    .bottom {
      display:flex;
      gap:12px;
      justify-content:center;
      margin-top:18px;
    }

    .pill {
      background:var(--pill);
      color:#fff;
      border-radius:28px;
      padding:12px 22px;
      font-weight:700;
      letter-spacing:1px;
      text-transform:uppercase;
      border:1px solid rgba(255,255,255,0.03);
      min-width:92px;
      text-align:center;
      cursor:pointer;
    }

    /* Larger screens: maintain the portrait look but allow expansion */
    @media (min-width: 600px) {
      :root{ --max-width: 720px; }
      .page{ padding:28px 28px 36px; }
      .title{ font-size:40px; }
      .photo{ width:128px;height:128px;border-width:6px; }
      .candidate{ width:140px; }
      .name{ font-size:34px; }
      .ev{ font-size:64px; }
      .bar-wrap{ max-width:520px; }
      .bar{ height:34px; border-radius:18px; }
      .marker{ top:-20px; height:76px; }
      .chart-stats{ font-size:13px; }
      .map{ height:55vh; }
    }
  </style>
</head>
<body>
  <div class="page" role="main" aria-labelledby="site-title">
    <h1 id="site-title" class="title">US XXXX ELECTIONS</h1>
    <div class="top-divider" aria-hidden="true"></div>
    <div class="subtitle" id="status">LIVE ELECTION NIGHT</div>

    <div class="top-row" role="region" aria-label="Top candidates and electoral bar">
      <!-- Left candidate -->
      <div class="candidate" id="left-cand">
        <div class="photo" aria-hidden="true">
          <!-- image file omitted per your instruction; replace src to show photo -->
          <img src="images/walz.jpg" alt="Left candidate photo" onerror="this.style.opacity=0.0" />
        </div>
        <div class="name" id="left-name">WALZ</div>
        <div class="ev" id="left-ev">284</div>
      </div>

      <!-- Center bar -->
      <div class="center" role="figure" aria-label="Electoral vote progress">
        <div class="bar-wrap">
          <div class="bar" id="electoralBar">
            <div class="seg left" id="seg-left" style="width:0%"></div>
            <div class="seg unc" id="seg-unc" style="width:0%"></div>
            <div class="seg right" id="seg-right" style="width:0%"></div>
          </div>
          <div class="marker" id="marker" aria-hidden="true"></div>
          <div class="marker-label" aria-hidden="true">270 to win</div>
        </div>

        <div class="stats" aria-hidden="true">
          <div id="left-stats">52.6% | 72,520,517</div>
          <div id="right-stats">49.2% | 68,434,231</div>
        </div>
      </div>

      <!-- Right candidate -->
      <div class="candidate" id="right-cand">
        <div class="photo" aria-hidden="true">
          <img src="images/couch.jpg" alt="Right candidate photo" onerror="this.style.opacity=0.0" />
        </div>
        <div class="name" id="right-name">COUCH</div>
        <div class="ev" id="right-ev">194</div>
      </div>
    </div>

    <!-- Map placeholder -->
    <div class="map" id="map">
  <div class="map-inner">
    <object id="us-map" data="us.svg" type="image/svg+xml"></object>
  </div>
    </div>

    <!-- Bottom pills -->
    <div class="bottom" role="navigation" aria-label="Switch races">
      <button class="pill" id="pill-house">House</button>
      <button class="pill" id="pill-senate">Senate</button>
      <button class="pill" id="pill-governor">Governor</button>
    </div>
  </div>

  <script>
    // Mobile-first electoral UI script
    

    // live data placeholders (will be filled from Google Sheets)
let leftEV = 0;
let rightEV = 0;
let undecidedEV = CONSTANTS.TOTAL_EV;

let leftVotes = 0;
let rightVotes = 0;
let otherVotes = 0;

    function numberWithCommas(n){
      return new Intl.NumberFormat('en-US').format(n);
    }

    function pct(part, total) {
      if (!total) return "0.0%";
      return ( (part / total) * 100 ).toFixed(1) + "%";
    }

    function updateBar(){
      const leftW = (leftEV / CONSTANTS.TOTAL_EV) * 100;
const rightW = (rightEV / CONSTANTS.TOTAL_EV) * 100;
const uncW = (undecidedEV / CONSTANTS.TOTAL_EV) * 100;
      document.getElementById('seg-left').style.width = leftW + '%';
      document.getElementById('seg-right').style.width = rightW + '%';
      document.getElementById('seg-unc').style.width = uncW + '%';

      // marker position (absolute center at 270 EV)
      const marker = document.getElementById('marker');
      const markerPos = (CONSTANTS.WIN_EV / CONSTANTS.TOTAL_EV) * 100;
      marker.style.left = markerPos + '%';
    }

    function updateText(){
      document.getElementById('left-ev').textContent = leftEV;
      document.getElementById('right-ev').textContent = rightEV;

      const totalPop = leftVotes + rightVotes + otherVotes;
      document.getElementById('left-stats').textContent = `${pct(leftVotes, totalPop)} | ${numberWithCommas(leftVotes)}`;
      document.getElementById('right-stats').textContent = `| ${pct(rightVotes, totalPop)}\n${numberWithCommas(rightVotes)}`;

      const status = document.getElementById('status');
      if (leftEV >= CONSTANTS.WIN_EV && leftEV > rightEV) {
        status.textContent = 'PROJECTED WINNER — WALZ';
      } else if (rightEV >= CONSTANTS.WIN_EV && rightEV > leftEV) {
        status.textContent = 'PROJECTED WINNER — COUCH';
      } else {
        status.textContent = 'LIVE ELECTION NIGHT';
      }
    }

    // initial render
    function render(){
      updateBar();
      updateText();
    }

//    render();

    // =======================
// LIVE GOOGLE SHEETS DATA
// =======================

const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsbbXqdgfMGosYWjOVNR-2UUw6bZzjGNtnfuuWpbBuTutk6Jm1lffgHUis8GNjfQLFZLkaSpJNlck2/pub?gid=0&single=true&output=csv";



// candidate IDs (must match your internal order)


fetch(CSV_URL)
  .then(res => res.text())
  .then(csv => {
    const rows = csv.trim().split("\n").map(r => r.split(","));

    // reset totals
    leftEV = 0;
    rightEV = 0;
    undecidedEV = 0;
    leftVotes = 0;
    rightVotes = 0;
    otherVotes = 0;

    // skip header rows (A3 = index 2)
    for (let i = 2; i < rows.length; i++) {
      const row = rows[i];

      const stateCode = row[0]?.trim();
      const ev = Number(row[1]);

      const c1 = Number(row[11]); // L
      const c2 = Number(row[12]); // M
      const c3 = Number(row[13]); // N

      if (!stateCode || !ev || (c1 + c2 + c3) === 0) continue;

      const totalPoints = c1 + c2 + c3;
      const stateVotes = ev * CONSTANTS.VOTES_PER_EV;

      const votes = [
  Math.round(stateVotes * (c1 / totalPoints)),
  Math.round(stateVotes * (c2 / totalPoints)),
  Math.round(stateVotes * (c3 / totalPoints))
];

      // national popular vote
      leftVotes += votes[0];
      rightVotes += votes[1];
      otherVotes += votes[2];

      // determine state winner
      const maxVotes = Math.max(...votes);
      const winnerIndex = votes.indexOf(maxVotes);

      // assign ALL EVs (winner takes all)
      if (winnerIndex === 0) leftEV += ev;
      else if (winnerIndex === 1) rightEV += ev;
      else {
        // third candidate wins state → EVs still count nationally
        // but they do not appear in top row
      }
    }

    undecidedEV = Math.max(0, CONSTANTS.TOTAL_EV - leftEV - rightEV);
    // update UI
    render();
  })
  .catch(err => {
    console.error("Failed to load election data:", err);
  });
    // Example API: you can call setData(...) to update the UI live
    window.setData = function({leftEV:newLeft, rightEV:newRight, leftVotes:newLeftVotes, rightVotes:newRightVotes}){
      if (typeof newLeft === 'number') leftEV = newLeft;
      if (typeof newRight === 'number') rightEV = newRight;
      undecidedEV = Math.max(0, TOTAL_EV - leftEV - rightEV);
      if (typeof newLeftVotes === 'number') leftVotes = newLeftVotes;
      if (typeof newRightVotes === 'number') rightVotes = newRightVotes;
      render();
    };

    // Touch-friendly pills (placeholders)
    document.getElementById('pill-house').addEventListener('click', ()=> alert('House view not implemented yet'));
    document.getElementById('pill-senate').addEventListener('click', ()=> alert('Senate view not implemented yet'));
    document.getElementById('pill-governor').addEventListener('click', ()=> alert('Governor view not implemented yet'));
  </script>
</body>
</html>
